<?php require "registration/inc_db.php"; require "registration/inc_forms.php"; dbconnect();$people_table 		= "people";					// PEOPLE OR PEOPLE_TESTING$not_people_fields 	= array("submit",							"email_list",							"is_new",							"id"); 				// THESE FIELDS ARE **NOT** IN THE PEOPLE TABLE SO DON'T USE THEM							if(isset($_POST["submit"]))						// THEM FORM HAS BEEN POSTED{	$where_clause 	= " WHERE email = '" . $_POST['email'] . "'";	$query 			= "SELECT ID, email, company, address1, address2, cellphone FROM " . $people_table . $where_clause . " LIMIT 0 , 1";	$result 		= safe_query($query);		// QUERY THAT CHECKS FOR EXISTING RECORDS	if ($result)								// QUERY WAS SUCCESSFUL	{		$n_rows = mysql_num_rows($result);		// HOW MANY ROWS?		if ($n_rows == 1)						// THERE IS ONE RECORD IN THE DB, COMPARE SOME FIELDS AND EMAIL IF THERE IS A CHANGE		{			$row 		= mysql_fetch_array($result, MYSQL_ASSOC);			$ID 		= $row["ID"];			// GET PEOPLE ID FROM PEOPLE			$company 	= $row["company"];			$address1 	= $row["address1"];			$address2 	= $row["address2"];			$cellphone 	= $row["cellphone"];			$body 		= compare_fields($company, $address1, $address2, $cellphone);			if(strlen($body) > 1)				// IF THERE IS A BODY VALUE THEN VALUES HAVE BEEN UPDATED			{				send_email($body);				// SEND EMAIL TO KEVIN IF FIELDS HAVE CHANGED			}		}		else									// THERE IS NOT A MATCHING RECORD IN THE DB -> DO INSERT		{			$ID = insert_people();				// PUT THEM IN THE PEOPLE TABLE		}		if (isset($_POST["email_list"]))		{			foreach($_POST["email_list"] as $e) 	// TAG THEM			{				add_to_list($ID, $e);			}		}				unset($_POST["submit"]);				// TO PREVENT DOUBLE SUBMISSIONS	}}	?><? echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n"; ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml">  <head>    <title>Supernova 2006 - Signup for Supernova Mailing Lists</title>	<meta name="author" content="Supernova 2006" />    <meta name="keywords" content="supernova, supernova2006, conference, technology, internet, computing, communications, digital media, social software, business, emerging technology, tech companies, web, web 2.0, kevin werbach, san francisco" />    <meta name="description" content="The Supernova conference focuses on the technology-driven transformation of computing, communications, digital media, and business. " />    <meta name="robots" content="index, follow" />	<link rel='stylesheet' type='text/css' media='all' href='http://www.werbach.com/supernova2006new/go?css=site/site_css' />	<style type='text/css' media='screen'>@import "http://www.werbach.com/supernova2006new/go?css=site/site_css";</style>    <link rel="alternate" type="application/rss+xml" title="supernova" href="" />    <link rel="shortcut icon" type="image/x-ico" href="./favicon.ico" />  </head>  <body>   <div id="wrapper">    <div id="container">      <div id="header">        <h1>Supernova 2006: because technology is everyone's business</h1>      </div>      <div id="subheader">        <div id="whartonlogo"><a href="http://www.wharton.upenn.edu/"><img src="http://www.werbach.com/supernova2006new/i/whartonlogo.jpg" width="110" height="55" alt="Produced in Partnership with Wharton University of Pennsylvania" /></a></div>        <div id="quote">          <div id="quotebody">"One of the must-attends of the digerati and forward thinkers of the networked age."</div>          <div id="quoteauthor">John Seely Brown, Former Chief Scientist, Xerox</div>        </div>        <div class="clear"></div>      </div>      	  <ul id="navigation">        <li><a title="Home" href="http://www.werbach.com/supernova2006new/go">Home</a></li>        <li><a title="About" href="http://www.werbach.com/supernova2006new/go/about">About</a></li>        <li><a title="Register" href="https://www.supernovagroup.net/registration/register.php">Register</a></li>        <li><a title="Speakers" href="http://www.werbach.com/supernova2006new/go/speakers">Speakers</a></li>        <li><a title="Agenda" href="http://www.werbach.com/supernova2006new/go/agenda">Agenda</a></li>        <li><a title="Workshops" href="http://www.werbach.com/supernova2006new/go/workshops">Workshops</a></li>        <li><a title="Sponsors" href="http://www.werbach.com/supernova2006new/go/sponsors">Sponsors</a></li>        <li><a title="Weblog" href="http://www.werbach.com/supernova2006new/go/weblog">Weblog</a></li>        <li><a title="Contact Us" href="http://www.werbach.com/supernova2006new/go/contact">Contact Us</a></li>      </ul>		      <div id="leftcolumn">	    <h1>Supernova2006</h1>        <h2>June 21-23, 2006</h2>        <h6>San Francisco, CA</h6>        <p><a title="Venue Information and Reserverations" href="http://www.werbach.com/supernova2006new/go/venue">Venue Information and Reservations</a></p> 	   	      </div>      <div id="middlecolumn">        <img src="http://www.werbach.com/supernova2006new/i/gardencourt.jpg" width="394" height="89" alt="Garden Court" />        <h1>Supernova2006</h1><!-- ----------------- ENTER MAIN CONTENT BELOW ------------------------ -->		<h2>Signup for the Supernova Mailing LIst</h2>      <strong>Thank you for updating your information!</strong><!-- ----------------- END MAIN CONTENT ABOVE ------------------------ -->            </div>      <div id="rightcolumn">      <div id="subnav">	  <a title="Community Connection" href="http://www.werbach.com/supernova2006new/go/community-connection">Community Connection</a><br/>      <a title="Audio/Video" href="http://www.werbach.com/supernova2006new/go/media-center">Media Center</a><br/>      <a title="Connected Innovators" href="http://www.werbach.com/supernova2006new/go/connected-innovators">Connected Innovators</a><br/>      <a id="cohosted" title="TechCrunch" href="http://www.werbach.com/supernova2006new/go/connected-innovators"><img class="right" src="http://www.werbach.com/supernova2006new/i/co-hosted_tc.gif" width="120" height="14" alt="Techcrunch" border="0" /></a><br/><br/>       <a id="rss" title="RSS Feed" href="http://www.werbach.com/supernova2006new/go/weblog/rss_2.0"><img class="left" src="http://www.werbach.com/supernova2006new/i/rssicon.jpg" width="28" height="28" alt="RSS Icon" /> Subscribe to RSS</a>	   </div>		        <div class="sponsors">Premium Sponsor</div>        <img src="http://www.werbach.com/supernova2006new/i/att.jpg" width="95" height="45" alt="ATT" />        <br />        <p class="purple">A complete list of sponsors is available on our <a href="http://www.werbach.com/supernova2006new/go/sponsors">sponsors page</a>. For sponsorsorship information, please <a href="mailto:sponsor@supernova2006.com">email us</a>, or view our <a href="./../downloads/prospectus.pdf">Sponsor Prospectus</a> (PDF).</p>  <br /><br /><br />      </div>      <div class="clear"></div>      <div id="footer"></div>    </div>  </div>  </body></html><?php///////////////////////////////////////////////////////////////////////////////////////////////////////////// FUNTIONS BELOW ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////function insert_people(){//	global $ID;  						// PEOPLE ID	//TETSING	global $people_table;	global $not_people_fields;		$insert_people_fields = "";			// FIELDS TO INSERT	$insert_people_values = "";			// VALUES FOR THOSE FIELDS		foreach($_POST as $key => $value)  	// FOR EACH KEY IN THE POST ARRAY SHOW ME THE VALUE	{		if($value != "" && in_array($key, $not_people_fields) == FALSE) // THERE IS A VALUE AND THE KEY NOT ON THE BAD LIST		{			$insert_people_fields = $insert_people_fields . $key . ", ";			$insert_people_values = (get_magic_quotes_gpc()) ? $insert_people_values . "'" . $value . "', " : $insert_people_values . "'" . addslashes($value) . "', ";		}	}		$insert_people_fields .= "user_id, ";	$insert_people_fields .= "created_on, ";	$insert_people_fields .= "last_modified";			$insert_people_values .= "'" . strtoupper(substr(remove_char($_POST["last"] . $_POST["first"] . $_POST["email"]) , 0, 3)) . rand(1111,9999) . "', ";	$insert_people_values .= "'" . date("Y-m-d H:i:s") . "', ";	$insert_people_values .= "'" . date("Y-m-d H:i:s") . "'";		$sql_people = "INSERT INTO " . $people_table . " (" . $insert_people_fields . ") VALUES (" . $insert_people_values . ")"; // INSERT SQL SN2005 //TESTING	$result = safe_query($sql_people);	return(mysql_insert_id());}function compare_fields($c, $a1, $a2, $cp){	global $not_people_fields;		if($c <> $_POST["company"])	// COMPANY CHANGED	{		$body .= "Company has changed from \"$c\" to \"" . $_POST["company"] . "\"\r\n<br/><br/>";		$changed = 1;	}		if($a1 <> $_POST["address1"])	// ADDRERSS1 CHANGED	{		$body .= "Address1 has changed from \"$a1\" to \"" . $_POST["address1"] . "\"\r\n<br/><br/>";		$changed = 1;	}		if($a2 <> $_POST["address2"])	// ADDRERSS2 CHANGED	{		$body .= "Address2 has changed from \"$a2\" to \"" . $_POST["address2"] . "\"\r\n<br/><br/>";		$changed = 1;	}		if($cp <> $_POST["cellphone"])	// PHONE CHANGED	{		$body .= "Cell Phone has changed from \"$cellphone\" to \"" . $_POST["cellphone"] . "\"\r\n<br/><br/>";		$changed = 1;	}				if($changed == 1)		// THERE HAS BEEN A CHANGE	{		$body .=  "This data may have changed as well...<br/><br/>";		foreach($_POST as $key => $value)		// FOR EVERY FORM VALUE		{			if(in_array($key, $not_people_fields) == 0)	$body .= "$key: $value \n<br/>";  // IF IT IS A PEOPLE FIELD SHOW US		}		$body = "This message is from the opt-in page. There has been a change for " . $_POST["first"] . " " . $_POST["last"] . ".\r\n<br/><br/>" . $body;		return $body;	}}function add_to_list($id, $list){   		$query = "INSERT  INTO people_tags( people_id, user_id, tag, is_email_tag, Time_Added ) 					SELECT ID,  user_id, '" . $list . "', 1, NOW() 					FROM people						WHERE ID						IN ($id) ";		safe_query($query);}function send_email($body){	$to 		= "kevin@werbach.com";												// TO	$subject	= "Info Change From Opt-in List";									// SUBJECT	$headers 	.= 'From: Supernova Group <info@supernovagroup.net>' . "\r\n";		// FROM	$headers 	.= 'Bcc: ddinatale@w3on.com' . "\r\n";								// BCC FOR TESTING - PLEASE REMOVE	$headers 	.= "Content-type: text/html; charset=iso-8859-1" . "\r\n";			// MAKE HTML	mail($to,$subject,$body,$headers);  											// SEND IT}function remove_char($str){	$str = str_replace("'", "", $str);	$str = str_replace(" ", "", $str);	return $str;}function show_what_i_did(){	// QUERY FOR DISPLAYING RESULTS	/*	$where_clause 	= " WHERE email = '" . $_POST['email'] . "'";		//$_POST['email']	$query 			= "SELECT * FROM " . $people_table . " " . $where_clause . " LIMIT 0 , 1";	echo $query . "<hr/><hr/>";	$result 		= safe_query($query);	if ($result)							// QUERY WAS SUCCESSFUL	{		$n_rows = mysql_num_rows($result);	// HOW MANY ROWS?			while ($row = mysql_fetch_array($result)) 			{				for ($i=0; $i < mysql_num_fields($result); $i++) 	// GET VARIALBES FROM DB				{ 					${mysql_field_name($result, $i)} = $row[mysql_field_name($result, $i)]; 				}							}			}	*/}?>